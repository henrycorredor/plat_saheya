<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:;base64,=">
    <title>Ingresar</title>
</head>

<body>
    <p>Ingresar</p>
    <form id="formulario">
        <label for="nombre">Nombre:</label>
        <input name="nombre" type="text" /><br />
        <label for="contrasenia">Contraseña: </label>
        <input name='contrasenia' type="password" /><br />
        <input type="submit" value="entrar" />
    </form>
    <div id="estado"></div>
    <script>
        const formulario = document.getElementById('formulario')
        formulario.addEventListener('submit', manejadorFormulario)

        async function manejadorFormulario(evento) {
            evento.preventDefault()
            //------------
            const notificador = document.getElementById('estado')
            notificador.innerText = "Un momento por favor ..."
            //------------
            const datos = {
                nombre: formulario.elements['nombre'].value,
                contrasenia: formulario.elements['contrasenia'].value
            }
            //------------

            fetch('/api/identificarse', {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(datos)
            }).then(async res => {
               if (res.ok) {
                    notificador.innerText = "Un momento por favor..."
                    console.log('redireccionando...')
                    location.href = '/lista'
               }else{
                   const elDato = await res.json()
                   notificador.innerText = elDato.body
               }
            }).catch(err => {
                    notificador.innerText = "Hubo un error. Inténtelo más tarde"
                })
        }
    </script>
</body>

</html>